/*****************************************************/
/* Version 2. Better use of memory.                  */
/*****************************************************/
#include <stdio.h>
#include <stdlib.h>
#include <math.h>
#include <string.h>

struct data {
   char *brand;
   float engine;
   int miles;
   char *color;
} *autos;

/*****************************************************/
/* See how big the file is.                          */
/*****************************************************/
int scan(void) {
int size = 0;
char  s_temp[100];
int   i_temp;
float f_temp;
FILE *data;
   data = fopen("./hw3.data", "r");
   while (1) {
      fscanf(data, "%s %f %d %s", s_temp, &f_temp, &i_temp, s_temp);
      if (feof(data)) break;
      size++;
   }
   return size;
}

/*****************************************************/
/* See how big the file is.                          */
/*****************************************************/
int load(int size) {
int i;
char tempb[100];
char tempc[100];
FILE *data;
   data = fopen("./hw3.data", "r");
   for (i = 0; i < size; i++) {
      fscanf(data, "%s %f %d %s", tempb, &autos[i].engine, &autos[i].miles, tempc);
      autos[i].brand = calloc(strlen(tempb), sizeof(char));
      autos[i].color = calloc(strlen(tempc), sizeof(char));
      strcpy(autos[i].brand, tempb);
      strcpy(autos[i].color, tempc);
   }
   return size;
}

/*****************************************************/
/* Sort by float.                                    */
/*****************************************************/
void sortf(int size) {
int i, swapped;
struct data temp;
   temp.brand = calloc(100, sizeof(char));
   temp.color = calloc(100, sizeof(char));
   do {               
      swapped = 0; 
      for (i = 0; i < size-1; i++) {
          if (autos[i].engine > autos[i+1].engine) {
             temp       = autos[i];               
             autos[i]   = autos[i+1];
             autos[i+1] = temp;
             swapped = 1; 
          }                 
      }         
    } while (swapped);
}

/*****************************************************/
/* Sort by integer.       .                          */
/*****************************************************/
void sorti(int size) {
int i, swapped;
struct data temp;
   temp.brand = calloc(100, sizeof(char));
   temp.color = calloc(100, sizeof(char));
   do {               
      swapped = 0; 
      for (i = 0; i < size-1; i++) {
          if (autos[i].miles > autos[i+1].miles) {
             temp       = autos[i];               
             autos[i]   = autos[i+1];
             autos[i+1] = temp;
             swapped = 1; 
          }                 
      }         
   } while (swapped);
}

/*****************************************************/
/* Print high to low.                                */
/*****************************************************/
void printhl(int size) {
int i;
   for (i = size-1; i >= 0; i--) {
       printf("%s %f %d %s\n", autos[i].brand, autos[i].engine, autos[i].miles, autos[i].color);
   }
}

/*****************************************************/
/* Print low to high.                                */
/*****************************************************/
void printlh(int size) {
int i;
   for (i = 0; i < size; i++) {
       printf("%s %f %d %s\n", autos[i].brand, autos[i].engine, autos[i].miles, autos[i].color);
   }
}

/*****************************************************/
/* Main                                              */
/*****************************************************/
int main(void) {
int size;
char option;
    // Load data.
    size = scan();
    autos = calloc(size, sizeof(*autos));
    load(size);
    // Start menu.
    while (1) {
       printf("MENU\n");
       printf("1] Sort by float & print hi to lo.\n");
       printf("2] Sort by float & print lo to hi.\n");
       printf("3] Sort by int   & print hi to lo.\n");
       printf("4] Sort by int   & print lo to hi.\n");
       printf("5] Exit.\n");
       scanf("%c", &option);
       switch (option) {
          case '1': 
            sortf(size);
            printhl(size);
            break;
          case '2': 
            sortf(size);
            printlh(size);
            break;
          case '3': 
            sorti(size);
            printhl(size);
            break;
          case '4': 
            sorti(size);
            printlh(size);
            break;
          case '5':
            free(autos);												
            exit(1); 
       }
    }
}

